# Mechatronic Microcontroller Project

### Laboratory F: PWM for servo control

**Before the lab:**
- Ensure you have read the lecture notes on timers, PWM and servomotors
- Review the Atmega datasheet on timers and PWM
- Calculate prescaler values and comparison ranges suitable for the servo control task: the base period of the servomotor: a base period in the range 15-25ms is recommended

### Task:
Establish control over one servomotor, using a PWM signal generated by a microcontroller hardware timer.
- Generate a PWM signal with a frequency of 50Hz (period of 20ms), and a pulse-width of 1.5ms. This should be the neutral or centre position of the servo. Test the signal pin with a multimeter: you should read around 0.4V. If you have access to an oscilloscope, you can also check the signal directly.
- Show the calculations for the PWM base frequency and duty cycle in your lab book **(F1)**. Check your base frequency calculation very carefully before connecting your servo.
- Connect your servomotor, and confirm that it remains in the neutral position. If you have a velocity servo, adjust the trim with a screwdriver until the servo stops moving.
- Modify your program to step the PWM signal from 1.5ms to 2ms and back to 1ms, with 2s delays in between. Check the signal pin with a multimeter before connecting the servo (the reading should be between 0.25V and 0.5V). Connect the servo, and show it stepping through its range **(F2)**.
- Modify your program to read an analog input from the joystick, and to set the PWM pulse width between 1ms and 2ms in response to the joystick position. Check the signal pin with the multimeter before connecting the servo. Connect the servo, and show it moving in response to the joystick position **(F3)**.
- Some students will have a position servo (Futaba s3001), for which the position of the servo is in response to the signal. Some students may have a continuous rotation servo (Parralax), for which the speed and direction of the servo is in response to the signal.
- Explain how the timer control registers are configured in order to achieve your desired base period and range of movement. State clearly the safe operating range for your comparison register values. **(F4)**
- Use a flowchart to outline the logic of your program **(F5)**

<p align="center"> <img src="https://upload.wikimedia.org/wikipedia/commons/3/30/Two_hobby_servo_motors.jpg" alt="RC Servos" width="30%"> </p>

### Note:
- Demonstration marks can be claimed live in a Blackboard Collaborate session (preferred), or via a short (a few seconds) video emailed to your tutor.
- Lab book marks can be claimed live in the Collaborate session (preferred), or via pictures or scans emailed to your tutor. 
- Please include your student card in any emailed videos or images.
- Please be very careful to check the calculations for PWM frequency and pulse width before connecting the servo, as servos can be damaged by incorrect signals. If the servo behaves erratically, disconnect the board immediately. Ideally please get F1 checked before connecting the servo for F2.
